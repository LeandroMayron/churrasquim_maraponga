#!/bin/bash

# Ajustar Gradle Wrapper
sed -i 's#https://services.gradle.org/distributions/gradle-.*-all.zip#https://services.gradle.org/distributions/gradle-8.13-all.zip#g' android/gradle/wrapper/gradle-wrapper.properties

# Forçar Java 17 e AndroidX no gradle.properties
grep -qxF 'ORG_GRADLE_JAVA_HOME=/usr/lib/jvm/java-17-openjdk' android/gradle.properties || echo 'ORG_GRADLE_JAVA_HOME=/usr/lib/jvm/java-17-openjdk' >> android/gradle.properties
grep -qxF 'android.useAndroidX=true' android/gradle.properties || echo 'android.useAndroidX=true' >> android/gradle.properties
grep -qxF 'android.enableJetifier=true' android/gradle.properties || echo 'android.enableJetifier=true' >> android/gradle.properties

# Atualizar Kotlin no build.gradle
sed -i 's/kotlinVersion = ".*"/kotlinVersion = "2.0.21"/g' android/build.gradle
if ! grep -q 'kotlin-gradle-plugin' android/build.gradle; then
  sed -i '/ext {/a \        classpath("org.jetbrains.kotlin:kotlin-gradle-plugin:2.0.21")' android/build.gradle
fi

# Ajustar SDK no app/build.gradle
sed -i 's/compileSdkVersion .*/compileSdkVersion 35/' android/app/build.gradle
sed -i 's/targetSdkVersion .*/targetSdkVersion 35/' android/app/build.gradle
sed -i '/buildToolsVersion/d' android/app/build.gradle

echo "✅ Correções aplicadas! Agora rode: eas build -p android --profile production"
